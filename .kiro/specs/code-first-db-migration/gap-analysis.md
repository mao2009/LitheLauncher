# Implementation Gap Analysis: Code-First DB Migration

## 1. 迴ｾ迥ｶ縺ｮ隱ｿ譟ｻ (Current State Investigation)

### 荳ｻ隕√↑雉・肇縺ｨ繝ｬ繧､繧｢繧ｦ繝・- **繝・・繧ｿ繝吶・繧ｹ邂｡逅・*: `src/database.py` 縺悟髪荳縺ｮ邂｡逅・・繧､繝ｳ繝医〒縺吶・- **繧ｹ繧ｭ繝ｼ繝槫ｮ夂ｾｩ**: `DATABASE_SCHEMA` 螳壽焚縺ｫ SQL 譁・ｭ怜・縺ｨ縺励※繝上・繝峨さ繝ｼ繝峨＆繧後※縺・∪縺吶・- **繝槭う繧ｰ繝ｬ繝ｼ繧ｷ繝ｧ繝ｳ譁ｹ蠑・*: `initialize_database` 髢｢謨ｰ蜀・〒縲～PRAGMA table_info` 繧剃ｽｿ逕ｨ縺励※繧ｫ繝ｩ繝縺ｮ蟄伜惠繧・縺､縺壹▽繝√ぉ繝・け縺励∝ｭ伜惠縺励↑縺・ｴ蜷医↓ `ALTER TABLE` 繧貞ｮ溯｡後☆繧九い繝峨・繝・け縺ｪ譁ｹ蠑上〒縺吶・
### 隕冗ｴ・→繝代ち繝ｼ繝ｳ
- **蛻晄悄蛹悶ヵ繝ｭ繝ｼ**: 繧｢繝励Μ襍ｷ蜍墓凾縺ｫ `main.py` 縺九ｉ蜻ｼ縺ｳ蜃ｺ縺輔ｌ縲∝酔譛溽噪縺ｫ螳溯｡後＆繧後∪縺吶・- **繧ｨ繝ｩ繝ｼ繝上Φ繝峨Μ繝ｳ繧ｰ**: `sqlite3.Error` 繧偵く繝｣繝・メ縺励※繝ｭ繧ｰ繧定ｨ倬鹸縺励∝・繧ｹ繝ｭ繝ｼ縺励∪縺吶・- **繝医Λ繝ｳ繧ｶ繧ｯ繧ｷ繝ｧ繝ｳ**: 繝槭う繧ｰ繝ｬ繝ｼ繧ｷ繝ｧ繝ｳ蜃ｦ逅・・譛蠕後↓荳蠎ｦ縺縺・`conn.commit()` 縺瑚｡後ｏ繧後※縺・∪縺吶・
## 2. 隕∽ｻｶ縺ｮ螳溽樟蜿ｯ閭ｽ諤ｧ蛻・梵 (Requirements Feasibility Analysis)

### 謚陦鍋噪繝九・繧ｺ
- **螳｣險逧・せ繧ｭ繝ｼ繝槫ｮ夂ｾｩ**: 迴ｾ蝨ｨ縺ｮ SQL 譁・ｭ怜・繧偵￣ython 縺ｮ繝・・繧ｿ讒矩・郁ｾ樊嶌繧・が繝悶ず繧ｧ繧ｯ繝茨ｼ峨↓螟画鋤縺吶ｋ蠢・ｦ√′縺ゅｊ縺ｾ縺吶・- **繝舌・繧ｸ繝ｧ繝ｳ邂｡逅・ユ繝ｼ繝悶Ν**: `schema_version` 繝・・繝悶Ν繧呈眠隕丞ｰ主・縺励∫樟蝨ｨ縺ｮ謨ｴ謨ｰ繝舌・繧ｸ繝ｧ繝ｳ繧堤ｮ｡逅・☆繧句ｿ・ｦ√′縺ゅｊ縺ｾ縺吶・- **鬆・ｬ｡繝槭う繧ｰ繝ｬ繝ｼ繧ｷ繝ｧ繝ｳ繝ｭ繧ｸ繝・け**: 繝舌・繧ｸ繝ｧ繝ｳ N 縺九ｉ M 縺ｾ縺ｧ縺ｮ蟾ｮ蛻・せ繧ｯ繝ｪ繝励ヨ繧帝・分縺ｫ驕ｩ逕ｨ縺吶ｋ繧ｨ繝ｳ繧ｸ繝ｳ縺悟ｿ・ｦ√〒縺吶・- **繝舌ャ繧ｯ繧｢繝・・讖溯・**: `shutil.copy2` 遲峨ｒ菴ｿ逕ｨ縺励※縲√・繧､繧ｰ繝ｬ繝ｼ繧ｷ繝ｧ繝ｳ螳溯｡悟燕縺ｫ `.db` 繝輔ぃ繧､繝ｫ縺ｮ迚ｩ逅・さ繝斐・繧剃ｽ懈・縺吶ｋ讖溯・縺悟ｿ・ｦ√〒縺吶・
### 繧ｮ繝｣繝・・縺ｨ蛻ｶ邏・- **Missing**: 繧ｹ繧ｭ繝ｼ繝槭ヰ繝ｼ繧ｸ繝ｧ繝ｳ縺ｨ縺・≧讎ょｿｵ閾ｪ菴薙′蟄伜惠縺励∪縺帙ｓ縲・- **Missing**: 繝槭う繧ｰ繝ｬ繝ｼ繧ｷ繝ｧ繝ｳ縺ｮ螳溯｡悟ｱ･豁ｴ繧剃ｿ晏ｭ倥☆繧句ｴ謇縺後≠繧翫∪縺帙ｓ縲・- **Missing**: 螟ｱ謨玲凾縺ｮ閾ｪ蜍輔Ο繝ｼ繝ｫ繝舌ャ繧ｯ・育黄逅・ヵ繧｡繧､繝ｫ蠕ｩ蜈・ｼ峨Ο繧ｸ繝・け縺後≠繧翫∪縺帙ｓ・・QLite 縺ｮ `ALTER TABLE` 縺ｯ荳驛ｨ蛻ｶ髯舌′縺ゅｋ縺溘ａ縲∫黄逅・ヰ繝・け繧｢繝・・縺碁㍾隕√〒縺呻ｼ峨・- **Constraint**: 譌｢蟄倥・繝ｦ繝ｼ繧ｶ繝ｼ迺ｰ蠅・↓縺ｯ譌｢縺ｫ `Game` 繝・・繝悶Ν縺悟ｭ伜惠縺吶ｋ縺溘ａ縲√◎繧後ｉ繧堤ｴ螢翫○縺壹↓繝舌・繧ｸ繝ｧ繝ｳ 1 縺ｨ縺励※隱崎ｭ倥＆縺帙ｋ蛻晄悄蛹門・逅・ｼ医・繝ｼ繝医せ繝医Λ繝・ヴ繝ｳ繧ｰ・峨′蠢・ｦ√〒縺吶・
## 3. 螳溯｣・い繝励Ο繝ｼ繝√・繧ｪ繝励す繝ｧ繝ｳ (Implementation Approach Options)

### 繧ｪ繝励す繝ｧ繝ｳ A: 譌｢蟄倥・ `src/database.py` 繧呈僑蠑ｵ (Extend Existing Component)
**讀懆ｨ守炊逕ｱ**: 繝・・繧ｿ繝吶・繧ｹ髢｢騾｣繝ｭ繧ｸ繝・け縺・繝輔ぃ繧､繝ｫ縺ｫ縺ｾ縺ｨ縺ｾ縺｣縺ｦ縺・ｋ縺溘ａ縲∫ｮ｡逅・′螳ｹ譏薙〒縺吶・
- **螟画峩蜀・ｮｹ**:
  - 繧ｹ繧ｭ繝ｼ繝槫ｮ夂ｾｩ繧・Python 縺ｮ繝ｪ繧ｹ繝・霎樊嶌蠖｢蠑上↓繝ｪ繝輔ぃ繧ｯ繧ｿ繝ｪ繝ｳ繧ｰ縲・  - 繝槭う繧ｰ繝ｬ繝ｼ繧ｷ繝ｧ繝ｳ繧ｹ繧ｯ繝ｪ繝励ヨ繧偵ヰ繝ｼ繧ｸ繝ｧ繝ｳ逡ｪ蜿ｷ莉倥″縺ｮ繝ｪ繧ｹ繝医→縺励※邂｡逅・・  - `initialize_database` 蜀・↓繝舌・繧ｸ繝ｧ繝ｳ豈碑ｼ・→繝ｫ繝ｼ繝怜・逅・ｒ霑ｽ蜉縲・- **繝｡繝ｪ繝・ヨ**: 繝輔ぃ繧､繝ｫ讒区・縺悟､峨ｏ繧峨★縲∵里蟄倥・萓晏ｭ倬未菫ゅ↓蠖ｱ髻ｿ繧剃ｸ弱∴縺ｪ縺・・- **繝・Γ繝ｪ繝・ヨ**: 繝輔ぃ繧､繝ｫ縺瑚ぇ螟ｧ蛹悶＠縲√・繧､繧ｰ繝ｬ繝ｼ繧ｷ繝ｧ繝ｳ繧ｨ繝ｳ繧ｸ繝ｳ縺ｮ繝ｭ繧ｸ繝・け縺ｨ繧ｹ繧ｭ繝ｼ繝槫ｮ夂ｾｩ縺梧ｷｷ蝨ｨ縺吶ｋ縲・
### 繧ｪ繝励す繝ｧ繝ｳ B: 蟆ら畑縺ｮ繝槭う繧ｰ繝ｬ繝ｼ繧ｷ繝ｧ繝ｳ繝槭ロ繝ｼ繧ｸ繝｣繝ｼ繧呈眠險ｭ (Create New Component)
**讀懆ｨ守炊逕ｱ**: 繝槭う繧ｰ繝ｬ繝ｼ繧ｷ繝ｧ繝ｳ繝ｭ繧ｸ繝・け縺ｯ螳壼梛逧・↑縲後お繝ｳ繧ｸ繝ｳ縲阪〒縺ゅｋ縺溘ａ縲∽ｻ悶・繝ｭ繧ｸ繝・け縺ｨ蛻・屬縺吶ｋ縺薙→縺ｧ蜀榊茜逕ｨ諤ｧ縺ｨ繝・せ繝域ｧ繧帝ｫ倥ａ縺ｾ縺吶・
- **螟画峩蜀・ｮｹ**:
  - `src/db_migration.py` 繧剃ｽ懈・縺励√ヰ繝・け繧｢繝・・縲√ヰ繝ｼ繧ｸ繝ｧ繝ｳ繝√ぉ繝・け縲・←逕ｨ繝ｭ繧ｸ繝・け繧貞ｮ溯｣・・  - `src/database.py` 縺ｯ邏皮ｲ九↑繧ｹ繧ｭ繝ｼ繝槫ｮ夂ｾｩ縺ｨ謗･邯夂ｮ｡逅・・縺ｿ繧定｡後≧縲・- **繝｡繝ｪ繝・ヨ**: 髢｢蠢・・蛻・屬縺梧・遒ｺ縲ゅヰ繝・け繧｢繝・・繧・ｱ･豁ｴ邂｡逅・↑縺ｩ縺ｮ隍・尅縺ｪ繝ｭ繧ｸ繝・け繧貞腰菴薙ユ繧ｹ繝医＠繧・☆縺・・- **繝・Γ繝ｪ繝・ヨ**: 譁ｰ隕上ヵ繧｡繧､繝ｫ縺悟｢励∴縲～main.py` 縺九ｉ縺ｮ蜻ｼ縺ｳ蜃ｺ縺励す繝ｼ繧ｱ繝ｳ繧ｹ縺悟ｰ代＠隍・尅縺ｫ縺ｪ繧九・
### 繧ｪ繝励す繝ｧ繝ｳ C: 繝上う繝悶Μ繝・ラ繝ｻ繧｢繝励Ο繝ｼ繝・(Hybrid Approach) - 謗ｨ螂ｨ
- **謌ｦ逡･**: 
  - `src/database.py` 蜀・↓ `DatabaseManager` 繧ｯ繝ｩ繧ｹ繧貞ｰ主・縺励√◎縺ｮ荳ｭ縺ｧ繝槭う繧ｰ繝ｬ繝ｼ繧ｷ繝ｧ繝ｳ繝ｭ繧ｸ繝・け繧偵き繝励そ繝ｫ蛹悶☆繧九・  - 繧ｹ繧ｭ繝ｼ繝槫ｮ夂ｾｩ縺ｯ繧ｯ繝ｩ繧ｹ螳壽焚縺ｨ縺励※菫晄戟縺励∝推繝舌・繧ｸ繝ｧ繝ｳ縺ｮ譖ｴ譁ｰ蜀・ｮｹ・・QL・峨ｒ譏守｢ｺ縺ｫ螳夂ｾｩ縺吶ｋ縲・- **繝｡繝ｪ繝・ヨ**: 繝輔ぃ繧､繝ｫ謨ｰ繧呈椛縺医▽縺､縲∵焔邯壹″逧・↑險倩ｿｰ縺九ｉ繧ｪ繝悶ず繧ｧ繧ｯ繝域欠蜷代↑險ｭ險医∈遘ｻ陦後〒縺阪ｋ縲・
## 4. 螳溯｣・・隍・尅縺輔→繝ｪ繧ｹ繧ｯ (Implementation Complexity & Risk)

- **蟾･謨ｰ (Effort)**: **M (3-7 days)**
  - 繝ｭ繧ｸ繝・け閾ｪ菴薙・螳溯｣・・遏ｭ譛滄俣縺ｧ蜿ｯ閭ｽ縺ｧ縺吶′縲∵里蟄倥ョ繝ｼ繧ｿ・育音縺ｫ `unique_identifier` 繧・`image_path` 遲峨′譌｢縺ｫ謇句虚縺ｧ霑ｽ蜉縺輔ｌ縺ｦ縺・ｋ迺ｰ蠅・ｼ峨°繧峨・繧ｹ繝繝ｼ繧ｺ縺ｪ遘ｻ陦梧､懆ｨｼ縺ｫ譎る俣繧定ｦ√＠縺ｾ縺吶・- **繝ｪ繧ｹ繧ｯ (Risk)**: **Medium**
  - 繝槭う繧ｰ繝ｬ繝ｼ繧ｷ繝ｧ繝ｳ螟ｱ謨玲凾縺ｫ繝・・繧ｿ繝吶・繧ｹ縺御ｸ肴紛蜷医↑迥ｶ諷九↓縺ｪ繧九Μ繧ｹ繧ｯ縺後≠繧翫∪縺吶ら黄逅・ヰ繝・け繧｢繝・・縺ｨ繝医Λ繝ｳ繧ｶ繧ｯ繧ｷ繝ｧ繝ｳ蛻ｶ蠕｡縺ｮ蜴ｳ蟇・↑螳溯｣・′荳榊庄谺縺ｧ縺吶・
## 5. 險ｭ險医ヵ繧ｧ繝ｼ繧ｺ縺ｸ縺ｮ謗ｨ螂ｨ莠矩・(Recommendations for Design Phase)

- **蜆ｪ蜈医い繝励Ο繝ｼ繝・*: 繧ｪ繝励す繝ｧ繝ｳ C (DatabaseManager 縺ｫ繧医ｋ繧ｫ繝励そ繝ｫ蛹・ 繧呈治逕ｨ縲・- **驥崎ｦ∵ｱｺ螳壻ｺ矩・*: 
  - 譌｢蟄倥・縲梧焔蜍輔き繝ｩ繝霑ｽ蜉貂医∩縲咲憾諷九ｒ縺ｩ縺ｮ繝舌・繧ｸ繝ｧ繝ｳ縺ｨ螳夂ｾｩ縺吶ｋ縺具ｼ井ｾ具ｼ壽怙譁ｰ迥ｶ諷九ｒ Version 4 縺ｨ縺吶ｋ・峨・  - 繝槭う繧ｰ繝ｬ繝ｼ繧ｷ繝ｧ繝ｳ螻･豁ｴ繝・・繝悶Ν縺ｮ螳夂ｾｩ縲・- **隕∬ｪｿ譟ｻ鬆・岼 (Research Needed)**:
  - SQLite 縺ｧ `ALTER TABLE` 繧剃ｽｿ逕ｨ縺励◆髫帙・繝医Λ繝ｳ繧ｶ繧ｯ繧ｷ繝ｧ繝ｳ縺ｮ謖吝虚・井ｸ驛ｨ縺ｮ謫堺ｽ懊・繧ｳ繝溘ャ繝医ｒ蠢・ｦ√→縺吶ｋ蝣ｴ蜷医′縺ゅｋ・峨・  - 蟾ｨ螟ｧ縺ｪ繝・・繧ｿ繝吶・繧ｹ・・yzree 縺ｧ縺ｯ諠ｳ螳壹＠縺ｫ縺上＞縺鯉ｼ峨↓縺翫￠繧九ヰ繝・け繧｢繝・・縺ｮ繝代ヵ繧ｩ繝ｼ繝槭Φ繧ｹ縲・
